<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alarm</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container">
      <div
        class="vh-100 d-flex flex-column justify-content-center align-items-center"
      >
        <div>
          <div id="timedisplay" class="display-6 text-center"></div>
          <div id="remaintime" class="display-6 text-center mt-3"></div>
          <div
            id="error"
            class="display-6 bg-danger text-center text-white p-2 rounded"
          ></div>
        </div>

        <form>
          <div class="mb-3 mt-3">
            <input type="time" class="form-control" id="timeInput" />
          </div>

          <button
            type="button"
            id="save"
            class="btn btn-primary"
            onclick="saveTime()"
          >
            Add
          </button>
          <button
            type="button"
            id="stop"
            class="btn btn-danger"
            onclick="removeAlarm()"
            disabled
          >
            Stop and Clear Time
          </button>
        </form>

        <audio id="alarm" src="alarm.mp3" preload="auto"></audio>
      </div>
    </div>
    <script>
      var intervalStart;
      var timeElement = document.getElementById("timedisplay");
      const timedisplay = document.getElementById("remaintime");
      var timeInput = document.getElementById("timeInput");
      var stopButton = document.getElementById("stop");
      var saveButton = document.getElementById("save");
      var arrayOfTime = [];
      var alarmObj = document.getElementById("alarm");
      alarmObj.loop = true;
      const months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ];
      const week = [
        "Sunday",
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
      ];

      setInterval(() => {
        var time = new Date();
        timeElement.innerHTML = `${time.getHours()} : ${time.getMinutes()} : ${time.getSeconds()}<br>
        ${week[time.getDay()]} - ${
          months[time.getMonth()]
        } ${time.getDate()} ${time.getFullYear()}`;
      }, 1000);

      const getSto = () => {
        const targetTime = localStorage.getItem("selectedTime") || null;
        if (targetTime) {
          startTimeDisplay();
          timeInput.value = targetTime;
        }
      };
      getSto();

      function startTimeDisplay() {
        const targetTime = localStorage.getItem("selectedTime") || null;
        const tartime = targetTime.split(":");
        console.log("target time: ", targetTime);
        console.log(tartime);
        const currentDate = new Date();
        const targetDate = new Date(
          currentDate.getFullYear(),
          currentDate.getMonth(),
          currentDate.getDate(),
          tartime[0],
          tartime[1]
        );
        const updateRemainingTime = () => {
          const remainingTime = targetDate - new Date();
          const remainingSeconds = Math.floor(remainingTime / 1000);

          if (remainingSeconds > 0) {
            const hours = Math.floor(remainingSeconds / 3600);
            const minutes = Math.floor((remainingSeconds % 3600) / 60);
            const seconds = remainingSeconds % 60;
            timedisplay.innerHTML = `Remaining time: ${hours}:${minutes}:${seconds}`;
          } else {
            timedisplay.innerHTML = "AlarmOn";
            console.log("Alarm time reached!");
            playAlarm();
            stopTimeDisplay();
            localStorage.removeItem("selectedTime");
          }
        };
        updateRemainingTime();
        intervalStart = setInterval(updateRemainingTime, 1000);
      }

      function stopTimeDisplay() {
        clearInterval(intervalStart);
      }

      function saveTime() {
        var timeInput = document.getElementById("timeInput");
        var selectedTime = timeInput.value;

        var error = document.getElementById("error");

        if (selectedTime == "") {
          error.innerHTML = `Cannot be Null or 00:00`;
          return;
        }
        if (typeof Storage !== "undefined") {
          arrayOfTime.push(selectedTime.replace(":", ""));
          console.log(arrayOfTime);
          localStorage.setItem("selectedTime", selectedTime);
          console.log("Time saved to localStorage.");
          error.innerHTML = ``;
          startTimeDisplay();
        } else {
          console.log("Sorry, your browser does not support localStorage.");
        }
      }
      function playAlarm() {
        alarmObj.play();
      }
      function removeAlarm() {
        stopTimeDisplay();
        localStorage.removeItem("selectedTime");
        alarmObj.pause();
        alarmObj.currentTime = 0;
        timedisplay.innerHTML = "";
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
